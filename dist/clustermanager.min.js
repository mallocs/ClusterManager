!function e(t,r,s){function o(n,a){if(!r[n]){if(!t[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(i)return i(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[n]={exports:{}};t[n][0].call(l.exports,function(e){var r=t[n][1][e];return o(r?r:e)},l,l.exports,e,t,r,s)}return r[n].exports}for(var i="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var r=this;t=t||{},this.map=e,this.setMap(e),this.resetManager(t),this.setPrecision(this.zoomToPrecision(this.map.getZoom())),google.maps.event.addDomListener(e,"dragstart",function(){r.mapDragging=!0}),google.maps.event.addDomListener(e,"dragend",function(){r.mapDragging=!1,r._onMapMoveEnd()}),google.maps.event.addDomListener(e,"center_changed",function(){r.mapDragging||r._onMapMoveEnd()}),google.maps.event.addDomListener(e,"zoom_changed",function(){r._onMapMoveEnd()}),"undefined"!=typeof t.markers&&this.addMarkers(t.markers)}var i=e("./utils"),n=s(i),a=e("./LazyMarker"),h=s(a);window.ClusterManager=o||{},o.prototype=new google.maps.OverlayView,o.prototype.onAdd=function(){this.ready_=!0,google.maps.event.trigger(this,"ready_")},o.prototype.draw=function(){},o.prototype.resetManager=function(e){this.markers={},this.clusters={},this.cluster_fns={},this.cluster_meta={};var t=e.precision>=0&&e.precision<=27?e.precision:2;e=n["default"]({padding:200,visualize:!1,zoom_to_precision:function(e){return e+t},cluster_by_distance:!0,cluster_distance_factor:2048e3,icon_color:"00CC00"},e),this.opts=e},o.prototype.setPrecision=function(e){if(!(e>=50||0>e)){if(this.current_precision_=e,this.clear(),"undefined"==typeof this.clusters[e])for(var t=this.getMarkers(),r=0,s=t.length;s>r;r++){var o=t[r];"cluster"!==this.getMarkerMeta(o).subtype&&this.addToCluster(o,this.getMarkerMeta(o).type,e)}this.cluster(),this.updateMarkers()}},o.prototype.getPrecision=function(){return this.current_precision_},o.prototype.getGeohash=function(e,t,r){if(e=Math.min(e,90),e=Math.max(e,-90),t=Math.abs((t+180)%360)-180,0>=r)return"";var s=12,o=parseInt((e+90)*Math.pow(10,s)).toString(2),i=parseInt((t+180)*Math.pow(10,s)).toString(2),n="0000000000000000000000000000000000000000000000000",a=n.substr(0,49-o.length)+o,h=n.substr(0,49-i.length)+i,u=a.substr(0,r)+h.substr(0,r);return u},o.prototype.geohashGetLatLngBounds=function(e){var t=12,r=this.geohashGetPrecision(e),s="0000000000000000000000000000000000000000000000000",o=e.substr(0,r)+s.substr(0,49-r),i=e.substr(r,e.length)+s.substr(0,49-r),n="1111111111111111111111111111111111111111111111111",a=e.substr(0,r)+n.substr(0,49-r),h=e.substr(r,e.length)+n.substr(0,49-r),u=parseInt(o,2),l=parseInt(i,2),c=parseInt(a,2),p=parseInt(h,2),g=Math.max(-90,u/Math.pow(10,t)-90),f=Math.max(-180,l/Math.pow(10,t)-180),d=Math.min(90,c/Math.pow(10,t)-90),m=Math.min(180,p/Math.pow(10,t)-180);return new google.maps.LatLngBounds(new google.maps.LatLng(g,f),new google.maps.LatLng(d,m))},o.prototype.geohashGetPrecision=function(e){var t=e.length/2;return parseInt(t)!==t||0>t||t>=50?void 0:t},o.prototype.getNeighborBoxes=function(e,t){for(var r,s=this.geohashGetLatLngBounds(e),o=this.geohashGetPrecision(e),i=this.getGeohash(s.getSouthWest().lat()+1e-4,s.getSouthWest().lng()-1e-4,o),n=this.getGeohash(s.getSouthWest().lat()-1e-4,s.getSouthWest().lng()+1e-4,o),a=this.getGeohash(s.getNorthEast().lat()+1e-4,s.getNorthEast().lng()-1e-4,o),h=this.getGeohash(s.getNorthEast().lat()-1e-4,s.getNorthEast().lng()+1e-4,o),u=this.getGeohash(s.getSouthWest().lat()+1e-4,s.getSouthWest().lng()+1e-4,o),l=this.getGeohash(s.getSouthWest().lat()-1e-4,s.getSouthWest().lng()-1e-4,o),c=this.getGeohash(s.getNorthEast().lat()+1e-4,s.getNorthEast().lng()+1e-4,o),p=this.getGeohash(s.getNorthEast().lat()-1e-4,s.getNorthEast().lng()-1e-4,o),g=[i,n,a,h,u,l,c,p],f=0,d=[];r=g[f];f++)"undefined"!=typeof this.clusters[o][t][r]&&r!==e&&d.push(r);return d},o.prototype.boxToPolygon=function(e,t){t=n["default"]({map:this.map,strokeColor:"#f33f00",strokeWeight:5,strokeOpacity:1,fillColor:"#ff0000",fillOpacity:.2},t);var r=this.geohashGetLatLngBounds(e),s=r.getNorthEast(),o=r.getSouthWest(),i=new google.maps.Polygon({paths:t.paths||[s,new google.maps.LatLng(s.lat(),o.lng()),o,new google.maps.LatLng(o.lat(),s.lng()),s],strokeColor:t.strokeColor,strokeWeight:t.strokeWeight,strokeOpacity:t.strokeOpacity,fillColor:t.fillColor,fillOpacity:t.fillOpacity,map:t.map});return i},o.prototype.boxInBounds=function(e,t,r){var s=new google.maps.LatLngBounds(this.map.getBounds().getSouthWest(),this.map.getBounds().getNorthEast());if("undefined"!=typeof r){var o=this.map.getProjection(),i=Math.pow(2,this.map.getZoom()),n=new google.maps.Point(r/i||0,r/i||0),a=o.fromLatLngToPoint(t.getNorthEast()),h=o.fromLatLngToPoint(t.getSouthWest()),u=new google.maps.Point(a.x+n.x,a.y-n.y),l=new google.maps.Point(h.x-n.x,h.y+n.y),c=o.fromPointToLatLng(u),p=o.fromPointToLatLng(l);s.extend(c),s.extend(p)}var g=this.geohashGetLatLngBounds(e);return s.contains(g.getNorthEast())||s.contains(g.getSouthWest())||180===g.toSpan().lat()?!0:!1},o.prototype.addMarkers=function(e,t,r){if("[object Array]"===Object.prototype.toString.call(e))for(var s=0,o=e.length;o>s;s++){var i=e[s];this.addMarker(i,{type:t,subtype:r})}},o.prototype.addMarker=function(e,t){"undefined"==typeof t&&(t=this.getMarkerMeta(e));var r=new h["default"](e),s={type:"generic",subtype:"generic",hidden:!0,visible:!1};t=n["default"](s,t);var o=t.type,i=t.subtype;if("undefined"==typeof this.markers[o]&&(this.markers[o]={},this.cluster_meta[o]={count:{total:0,visible:0,cluster:0}}),"undefined"==typeof this.cluster_fns[o]&&this.setClusterFn(o,this.createClusterMarker),"undefined"==typeof this.markers[o][i]&&(this.markers[o][i]=[]),this.markers[o][i].push(r),"cluster"!==i&&(this.cluster_meta[o].count.total+=1,this.addToCluster(r,o,this.getPrecision())),"undefined"==typeof t.summary){var a=t.type.charAt(0).toUpperCase()+t.type.slice(1);t.summary="undefined"==typeof r.getTitle()?a+" marker "+this.count(t.type,"total"):r.getTitle()}this.setMarkerMeta(r,t)},o.prototype.count=function(e,t){return this.cluster_meta[e].count[t]},o.prototype.addToCluster=function(e,t,r,s){var o=this.clusters,i=e.getLatLng(),n=i.latitude,a=i.longitude;"undefined"==typeof o[r]&&(o[r]={}),"undefined"==typeof o[r][t]&&(o[r][t]={});var h=o[r][t];if("undefined"==typeof s&&(s=this.getGeohash(n,a,r)),"undefined"!=typeof h[s]){h[s].markers.push(e);var u=h[s].markers.length,l=(u-1)/u*h[s].center[0]+n/u,c=(u-1)/u*h[s].center[1]+a/u;h[s].center=[l,c]}else h[s]={cluster:!1,markers:[e],center:[n,a]}},o.prototype.removeFromCluster=function(e,t){var r=this.geohashGetPrecision(t),s=this.getMarkerMeta(e).type,o=this.clusters[r][s][t];if(1===o.markers.length)delete this.clusters[r][s][t];else if(o.markers.length>1){for(var i,n=0,a=[],h=0,u=0;i=o.markers[n];n++)i!==e&&(a.push(i),h+=i.getLatLng().latitude,u+=i.getLatLng().longitude);h/=a.length,u/=a.length,o.center=[h,u],o.markers=a,o.cluster=!1,this.clusters[r][s][t]=o}},o.prototype.combineBoxes=function(e,t,r){var s=this.geohashGetPrecision(e);if(this.clusters[s][r][e].markers.length<this.clusters[s][r][t].markers.length){var o=e;e=t,t=o}for(var i,n=this.clusters[s][r][t].markers.length,a=n-1;a>=0;a--)i=this.clusters[s][r][t].markers[a],this.removeFromCluster(i,t),this.addToCluster(i,r,s,e)},o.prototype.combineClustersByDistance=function(e){var t=this.getPrecision(),r=this.clusters,s=this.opts.cluster_distance_factor||2048e3;for(var o in r[t][e]){for(var i,n=this.getNeighborBoxes(o,e),a=s*Math.pow(2,-t+2),h=r[t][e][o].center,u=0,l=0;i=n[u];u++){h=r[t][e][o].center;var c=r[t][e][i].center,p=google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(h[0],h[1]),new google.maps.LatLng(c[0],c[1]));a>p&&(l=u,a=p)}l&&(i=n[l],this.combineBoxes(o,i,e))}},o.prototype.cluster=function(e){var t,r,s,o,i=this.getPrecision();if("undefined"!=typeof e){if("undefined"!=typeof this.markers[e]){if("undefined"!=typeof this.markers[e].cluster)for(o=0,r;r=this.markers[e].cluster[o];o++)r.setVisible(!1);this.markers[e].cluster=[],this.cluster_meta[e].count.cluster=0,t=this.clusters,this.opts.cluster_by_distance&&this.combineClustersByDistance(e);for(var n in t[i][e]){this.opts.visualize&&this.boxToPolygon(n).setMap(this.map);var a=t[i][e][n];for(o=0,s=[];r=a.markers[o];o++){var h=this.getMarkerMeta(r);"undefined"!=typeof h.hidden&&h.hidden||s.push(r)}s.length>1?(a.cluster=this.cluster_fns[e](s,a.center[0],a.center[1],this),this.addMarker(a.cluster,{type:e,subtype:"cluster",hidden:!1}),this.cluster_meta[e].count.cluster+=1):a.cluster=!1}}}else{t=this.clusters[i];for(e in t)this.cluster(e)}},o.prototype.getMarkers=function(e,t,r){var s=[];if(this.markers==={})return[];if("undefined"==typeof e)for(e in this.markers)for(t in this.markers[e])s=s.concat(this.markers[e][t]);else if("undefined"==typeof t)for(t in this.markers[e])s=s.concat(this.markers[e][t]);else try{s=this.markers[e][t]||[]}catch(o){s=[]}if("undefined"==typeof r)return s;for(var i=0,n=[],a=s.length;a>i;i++){var h=s[i],u=this.getMarkerMeta(h);("all"===r||u.hidden!==r&&u.visible===r&&"function"!=typeof h&&"cluster"!==u.type)&&n.push(h)}return n},o.prototype._onMapMoveEnd=function(){var e=this;"undefined"!=typeof e.moveTimeout&&(clearTimeout(e.moveTimeout),delete e.moveTimeout);var t=e.zoomToPrecision(e.map.getZoom());e.getPrecision()!==t?e.setPrecision(t):e.moveTimeout=setTimeout(function(){delete e.moveTimeout,e.updateMarkers()},100)},o.prototype.show=function(e,t){this._showHide(e,t,!1)},o.prototype.hide=function(e,t){this._showHide(e,t,!0)},o.prototype._showHide=function(e,t,r){for(var s=this,o=this.getMarkers(e,t),i=0,n=o.length;n>i;i++){var a=o[i];this.getMarkerMeta(a).hidden=r}this.ready_?this._lagUpdate(e):google.maps.event.addListenerOnce(this,"ready_",function(){s._lagUpdate(e)})},o.prototype._lagUpdate=function(e){var t=this;"undefined"!=typeof this.processingTimeout&&(clearTimeout(t.processingTimeout),delete t.processingTimeout),this.processingTimeout=setTimeout(function(){delete t.processingTimeout,t.clear(e),t.cluster(e),t.updateMarkers()},100)},o.prototype.reset=function(e){if("undefined"!=typeof e){this.clear(e);for(var t in this.clusters)delete this.clusters[t][e],this.clusters[t][e]={};delete this.markers[e],this.markers[e]={}}else{var r=this.clusters[this.getPrecision()];for(e in r)this.reset(e)}},o.prototype.clear=function(e){for(var t=this.getMarkers(e),r=0,s=t.length;s>r;r++){var o=t[r];o.setMap(null),this.getMarkerMeta(o).visible=!1}if("undefined"!=typeof e&&this.cluster_meta&&this.cluster_meta[e])this.cluster_meta[e].count.visible=0;else for(var i in this.cluster_meta)this.cluster_meta[i].count.visible=0},o.prototype.zoomToPrecision=function(e){return this.opts.zoom_to_precision(e)},o.prototype.updateMarkers=function(){var e,t,r,s,o=this.getPrecision(),i=this.map.getBounds(),n=this.clusters[o];for(var a in n){var h=n[a];for(var u in h){var l=h[u],c=this.getMarkerMeta(l.cluster);if(this.boxInBounds(u,i,this.opts.padding))if(l.cluster){if(!c.hidden&&!c.visible){for(s=0,r=l.markers.length;r>s;s++)e=l.markers[s],this.getMarkerMeta(e).visible=!0;l.cluster.setMap(this.map),l.cluster.setVisible(!0),c.visible=!0,this.cluster_meta[a].count.visible+=1}}else e=l.markers[0],t=this.getMarkerMeta(e),t.hidden||t.visible||(e.setMap(this.map),e.setVisible(!0),t.visible=!0,this.cluster_meta[a].count.visible+=1);else if(l.cluster)l.cluster.setVisible(!1),c.visible&&(this.cluster_meta[a].count.visible-=1),c.visible=!1;else for(s=0,r=l.markers.length;r>s;s++)e=l.markers[s],t=this.getMarkerMeta(e),e.setVisible(!1),t.visible&&(this.cluster_meta[a].count.visible-=1),t.visible=!1}}},o.prototype.setClusterFn=function(e,t){this.cluster_fns[e]=t},o.prototype.setMarkerMeta=function(e,t){var r=n["default"](t,e._cluster_meta);e._cluster_meta=n["default"](r,t)},o.prototype.getMarkerMeta=function(e){try{return e._cluster_meta}catch(t){return e._cluster_meta={},e._cluster_meta}},o.prototype.createClusterIcon=function(e,t,r,s){var o;if(s=s||"000000",t>10)o={url:"http://chart.apis.google.com/chart?cht=d&chdp=mapsapi&chl=pin%27i\\%27["+e+"%27-2%27f\\hv%27a\\]h\\]o\\"+r+"%27fC\\"+s+"%27tC\\000000%27eC\\Lauto%27f\\&ext=.png",size:new google.maps.Size(21,34)};else{var i=6*((e+"").length-1)+24;o={size:new google.maps.Size(i,i),anchor:new google.maps.Point(i/2,i/2),shape:{coord:[i/2,i/2,i/2],type:"circle"},url:"http://chart.apis.google.com/chart?cht=it&chs="+i+"x"+i+"&chco="+r+",000000ff,ffffff01&chl="+e+"&chx="+s+",0&chf=bg,s,00000000&ext=.png"}}return this.createMarkerIconOpts(o)},o.prototype.createClusterMarker=function(e,t,r,s){function o(e){return function(t){google.maps.event.trigger(e,"click",t)}}var i=document.createElement("div");i.style.width="400px";for(var n,a=0;n=e[a];a++){var h=document.createElement("span");if(h.innerHTML="<b>"+s.getMarkerMeta(n).summary+"</b><br>",h.onclick=o(n),h.style.color="#334499",h.style.cursor="pointer",i.appendChild(h),a>=9)break}e.length>10&&i.appendChild(document.createTextNode(e.length-10+" more markers in this area. Zoom in for details."));var u=s.opts.icon_color[s.getMarkerMeta(e[0]).type]||s.opts.icon_color,l=s.createClusterIcon(e.length,s.getPrecision(),u);return n=s.createMarker({position:new google.maps.LatLng(t,r),title:e.length+" markers",content:i,summary:e.length+" markers",icon:l,shape:l.shape,zIndex:e.length})},o.prototype.createMarkerIconOpts=function(e){"undefined"==typeof e&&(e={}),"undefined"==typeof e.width&&(e.width=32),"undefined"==typeof e.height&&(e.height=32);var t,r=e.width,s=e.height;t="undefined"!=typeof e.icon_color?"object"==typeof e.icon_color&&"undefined"!=typeof e.type?e.icon_color[e.type]||"ff0000":e.icon_color:"undefined"!=typeof e.type&&this.opts&&"object"==typeof this.opts.icon_color?this.opts.icon_color[e.type]||"ff0000":this.opts&&this.opts.icon_color?this.opts.icon_color:"ff0000","undefined"==typeof e.strokeColor&&(e.strokeColor="000000"),"undefined"==typeof e.cornerColor&&(e.cornerColor="ffffff");var o="http://chart.apis.google.com/chart?cht=mm",i=o+"&chs="+r+"x"+s+"&chco="+e.cornerColor.replace("#","")+","+t+","+e.strokeColor.replace("#","")+"&ext=.png";return n["default"]({url:i,size:new google.maps.Size(r,s),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(r/2,s)},e)},o.prototype.createMarker=function(e){var t=this,r=this.createMarkerIconOpts(e),s={map:this.map,visible:!1,icon:r,content:"Marker"};e=n["default"](s,e);var o=new google.maps.Marker(e);if("undefined"==typeof e.fn){var i=new google.maps.InfoWindow({content:e.content});google.maps.event.addListener(o,"click",function(){var e=new Date;i.setZIndex(e.getTime()),i.open(t.map,o)})}else google.maps.event.addListener(o,"click",e.fn);return this.setMarkerMeta(o,e),o}},{"./LazyMarker":2,"./utils":3}],2:[function(e,t,r){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function o(e){this.raw_marker=e,this._marker="function"==typeof e.setMap?e:null,google.maps.event.addListener(this,"click",function(e){this._marker&&google.maps.event.trigger(this._marker,"click",e)})}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./utils"),n=s(i);o.prototype.setMap=function(e){if(this._marker)return void this._marker.setMap(e);if(e){var t={title:this.raw_marker.title,type:!1,subtype:"",content:""},r=n["default"](t,this.raw_marker);this._marker=ClusterManager.prototype.createMarker({title:r.title,type:r.type,content:r.content,position:new google.maps.LatLng(r.latitutde,r.longitude),subtype:r.subtype}),this._marker.setMap(e)}},o.prototype.getPosition=function(){if(this._marker&&this._marker.getPosition())return this._marker.getPosition();var e=this.getLatLng();return this.raw_marker.position=new google.maps.LatLng(e.latitutde,e.longitude),this.raw_marker.position},o.prototype.getLatLng=function(){return this._marker&&"undefined"==typeof this.raw_marker.latitude&&(this.raw_marker.position=this._marker.getPosition(),this.raw_marker.latitude=this.raw_marker.position.lat(),this.raw_marker.longitude=this.raw_marker.position.lng()),{latitude:this.raw_marker.latitude,longitude:this.raw_marker.longitude}},o.prototype.getTitle=function(){return this._marker&&this._marker.getTitle()||this.raw_marker.title},o.prototype.setVisible=function(e){this._marker&&this._marker.setVisible(e)},r["default"]=o,t.exports=r["default"]},{"./utils":3}],3:[function(e,t,r){"use strict";function s(e,t){if("object"!=typeof e)return{};if("object"!=typeof t)return e;for(var r in e)"undefined"==typeof t[r]&&(t[r]=e[r]);return t}t.exports=s},{}]},{},[1]);
//# sourceMappingURL=clustermanager.min.js.map